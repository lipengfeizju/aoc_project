<?xml version="1.0" encoding="ISO-8859-15"?>
<launch>
  <arg name="ns" default="scarab03" />

  <arg name="sensor_type" default="bearing" />
  <arg name="sensor_config_file" value="$(find phd_sensor)/config/$(arg sensor_type)_sensor.yaml" />

  <arg name="base_frame_id" default="base" />
  <arg name="odom_frame_id" default="odom" />
  <arg name="global_frame_id" default="map" />

  <node name="map" pkg="map_server" type="map_server" output="screen"
        args="$(find maps)/sim1/sim1.yaml" >
      <param name="frame_id" value="/map" />
  </node>

  <group ns="$(arg ns)">
    <node name="sensor_viz" pkg="phd_sensor" type="$(arg sensor_type)_vis"
          output="screen" respawn="false">
      <param name="frame_id" value="$(arg base_frame_id)"/>
    </node>

    <node name="sensor_throttle" pkg="phd_sensor" type="$(arg sensor_type)_throttle"
          output="screen" respawn="false">
      <param name="min_time" value="0.1"/>
      <param name="max_time" value="1.0"/>

      <param name="min_angle" value="0.785"/> <!-- pi/4 radians -->
      <param name="min_step" value="2.0"/>
    </node>

    <!-- conversion from object detections to bearing -->
    <node name="conversion" pkg="phd_conversion" type="detection_bearing" output="screen">
      <param name="sensor_frame_id" value="$(arg ns)/camera_rgb_frame" />
      <remap from="camera_info" to="camera/rgb/camera_info"/>
      <remap from="pose" to="odom"/>
      <remap from="object_detections" to="object_detector/object_detections"/>
    </node>



    <node name="phd_filter" pkg="phd_filter" type="phd_filter_$(arg sensor_type)_node"
          output="screen" respawn="false" launch-prefix="">
      <remap from="measurements" to="measurements_throttle"/>

      <param name="initialize_map" value="false" />

      <param name="num_targets" value="10.0" />
      <param name="max_value" value="0.01" />
      <param name="origin_x" value="-20" />
      <param name="origin_y" value="-15" />
      <param name="width" value="30.0" />
      <param name="height" value="30.0" />

      <param name="map_frame" value="$(arg global_frame_id)" />

      <rosparam file="$(arg sensor_config_file)" ns="sensor" command="load" />
      <rosparam file="$(find phd_filter)/config/static_motion_model.yaml" ns="motion" command="load" />
    </node>
  </group>


</launch>
